<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BulSU MSC | Edit Announcement</title>
  <link href="./Logos/Bulsu MSC Logo-02.png" rel="icon" type="image/png" />
  <!-- Replaced custom CSS with Tailwind and Font Awesome for consistent styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    * {
      font-family: 'Segoe UI', 'Segoe UI Web', 'Segoe UI Symbol', 'Helvetica Neue', 'Arial', sans-serif;
    }
  </style>
</head>
<body class="bg-[#080c24] min-h-screen">
    <!-- Sidebar -->
    <aside id="sidebar"
        class="bg-[#00071c] text-white w-64 min-h-screen fixed top-0 left-0 flex flex-col shadow-lg z-40 transition-transform duration-300 ease-in-out -translate-x-full lg:translate-x-0">
        <div class="flex flex-col items-center justify-center h-20 border-b border-white/20 px-4 py-3">
            <div class="flex items-center gap-2 mb-1">
                <img src="./Logos/Bulsu MSC Logo-02.png" alt="BulSU Microsoft Logo" class="w-8 h-8">
                <span class="text-2xl font-bold text-[#b9da05]">BulSU MSC</span>
            </div>
        </div>
        <nav class="flex-1 px-4 py-6 space-y-2">
            <a href="admin_dashboard.html"
                class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-[#b9da05] hover:text-[#011538] transition-colors">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="#"
                class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-[#b9da05] hover:text-[#011538] transition-colors">
                <i class="fas fa-user-graduate"></i> Students
            </a>
            <a href="admin_edit_event.html"
                class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-[#b9da05] hover:text-[#011538] transition-colors">
                <i class="fas fa-calendar-alt"></i> Events
            </a>
            <a href="admin_edit_announcement.html"
                class="flex items-center gap-3 px-4 py-3 rounded-lg bg-[#b9da05] text-[#011538] transition-colors">
                <i class="fas fa-bullhorn"></i> Announcements
            </a>
            <a href="#"
                class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-[#b9da05] hover:text-[#011538] transition-colors">
                <i class="fas fa-cog"></i> Settings
            </a>
        </nav>
    </aside>

    <!-- Mobile sidebar toggle button -->
    <button id="sidebarToggle" class="lg:hidden fixed top-4 left-4 z-50 bg-[#b9da05] text-[#011538] p-2 rounded-md">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Main content area -->
    <main class="lg:ml-64 p-6 transition-all duration-300">
        <!-- Updated page wrapper with consistent dark theme colors -->
        <div class="min-h-screen bg-[#080c24]">
            <div class="container mx-auto px-4 py-8">
                <!-- Updated banner with matching color scheme -->
                <div class="bg-[#011538] border border-[#b9da05] rounded-2xl p-8 mb-8 text-white shadow-2xl">
                    <h1 class="text-4xl font-bold mb-2 text-[#b9da05]">
                        <i class="fas fa-bullhorn mr-3"></i>Announcements
                    </h1>
                    <p class="text-gray-300 text-lg">Manage and customize announcements with ease.</p>
                </div>

                <!-- Updated card container with dark theme -->
                <div class="bg-[#011538] rounded-xl shadow-lg border border-white/20">
                    <!-- Updated tabs with consistent styling -->
                    <div class="flex border-b border-white/20 bg-[#00071c] rounded-t-xl">
                        <button class="tab-btn flex-1 px-6 py-4 text-white font-semibold border-b-2 border-[#b9da05] bg-[#011538] rounded-tl-xl" data-tab="active">
                            <i class="fas fa-edit mr-2"></i>Active
                        </button>
                        <button class="tab-btn flex-1 px-6 py-4 text-gray-400 font-semibold hover:text-[#b9da05] hover:bg-white/10 transition-colors" data-tab="archived">
                            <i class="fas fa-archive mr-2"></i>Archived
                        </button>
                        <button class="tab-btn flex-1 px-6 py-4 text-gray-400 font-semibold hover:text-[#b9da05] hover:bg-white/10 transition-colors rounded-tr-xl" data-tab="addnew">
                            <i class="fas fa-plus mr-2"></i>Add New
                        </button>
                    </div>

                    <!-- Updated content container with dark theme -->
                    <div class="p-6">
                        <!-- Active Tab -->
                        <div class="tab-panel" id="active">
                            <h3 class="text-2xl font-bold text-white mb-6">Active Announcements</h3>
                            <!-- Container JS will populate -->
                            <div id="activeAnnouncements" class="space-y-4"></div>
                        </div>


                        <!-- Archived Tab -->
                        <div class="tab-panel hidden" id="archived">
                            <h3 class="text-2xl font-bold text-white mb-6">Archived Announcements</h3>
                            <div class="bg-[#00071c] border border-white/20 rounded-lg p-6 text-white opacity-75">
                                <h4 class="text-xl font-semibold text-gray-400 mb-3">Archived Title</h4>
                                <p class="text-gray-400 mb-3">This is an archived announcement...</p>
                                <small class="text-gray-500">Archived by Admin</small>
                            </div>
                        </div>

                        <!-- Add New Tab -->
                        <div class="tab-panel hidden" id="addnew">
                            <form id="addAnnouncementForm" class="space-y-6">
                                <div>
                                    <label class="block text-white font-semibold mb-2">
                                        <i class="fas fa-newspaper mr-2 text-[#b9da05]"></i>Title
                                    </label>
                                    <input id="newTitle" type="text" placeholder="e.g. Orientation Week 2025" 
                                           class="w-full px-4 py-3 bg-[#00071c] border border-white/20 rounded-lg text-white placeholder-gray-400 focus:border-[#b9da05] focus:outline-none" />
                                </div>

                                <div>
                                    <label class="block text-white font-semibold mb-2">
                                        <i class="fas fa-thumbtack mr-2 text-[#b9da05]"></i>Announcement Text
                                    </label>
                                    <textarea id="newSummary" rows="3" placeholder="Short summary or preview..." 
                                              class="w-full px-4 py-3 bg-[#00071c] border border-white/20 rounded-lg text-white placeholder-gray-400 focus:border-[#b9da05] focus:outline-none resize-none"></textarea>
                                </div>

                                <div>
                                    <label class="block text-white font-semibold mb-2">
                                        <i class="fas fa-edit mr-2 text-[#b9da05]"></i>Full Content
                                    </label>
                                    <textarea id="newContent" rows="6" placeholder="Full announcement details..." 
                                              class="w-full px-4 py-3 bg-[#00071c] border border-white/20 rounded-lg text-white placeholder-gray-400 focus:border-[#b9da05] focus:outline-none resize-none"></textarea>
                                </div>

                                <div>
                                    <label class="block text-white font-semibold mb-2">
                                        <i class="fas fa-user mr-2 text-[#b9da05]"></i>Posted By
                                    </label>
                                    <input id="newPostedBy" type="text" value="Admin" 
                                           class="w-full px-4 py-3 bg-[#00071c] border border-white/20 rounded-lg text-white focus:border-[#b9da05] focus:outline-none" />
                                </div>

                                <div class="pt-4">
                                    <button type="submit" class="bg-[#b9da05] text-[#011538] px-6 py-3 rounded-lg font-semibold hover:bg-[#9abc04] transition-colors">
                                        <i class="fas fa-save mr-2"></i>Save Announcement
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Added footer from dashboard.html -->
        <footer class="bg-[#00071c] text-center p-6 border-t border-gray-800">
            <div class="flex justify-center space-x-1 mb-1">
                <a href="https://www.bulsu.edu.ph" target="_blank" rel="noopener noreferrer"><img src="./Logos/BulSU.png" alt="Bulacan State University Logo" class="h-10"></a>
                <a href="https://www.facebook.com/osobulsu" target="_blank" rel="noopener noreferrer"><img src="./Logos/OSOA.png" alt="Bulacan State University OSOA Logo" class="h-10 w-10"></a>
            </div>
            <p class="text-gray-500 text-sm">&copy; 2025 BulSU Microsoft Student Community. All rights reserved.</p>
            <div class="flex justify-center space-x-4 mt-2">
                <a href="https://www.facebook.com/bulsu.officialmsc" target="_blank" class="text-gray-400 hover:text-[#b9da05] transition-colors duration-300"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.instagram.com/bulsumsc/" target="_blank" class="text-gray-400 hover:text-[#b9da05] transition-colors duration-300"><i class="fab fa-instagram"></i></a>
                <a href="https://www.threads.com/@bulsumsc" target="_blank" class="text-gray-400 hover:text-[#b9da05] transition-colors duration-300"><i class="fab fa-threads"></i></a>
                <a href="https://www.tiktok.com/@bulsumsc" target="_blank" class="text-gray-400 hover:text-[#b9da05] transition-colors duration-300"><i class="fab fa-tiktok"></i></a>
                <a href="https://www.linkedin.com/company/bulsumsc/" target="_blank" class="text-gray-400 hover:text-[#b9da05] transition-colors duration-300"><i class="fab fa-linkedin"></i></a>
                <a href="https://www.github.com/bulsumsc" target="_blank" class="text-gray-400 hover:text-[#b9da05] transition-colors duration-300"><i class="fab fa-github"></i></a>
            </div>
        </footer>
    </main>

    <!-- Edit Announcement Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
    <div class="bg-[#011538] rounded-xl shadow-lg border border-white/20 w-full max-w-2xl p-6 text-white relative">
        <!-- Close button -->
        <button onclick="closeEditModal()" class="absolute top-3 right-3 text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
        </button>

        <h2 class="text-2xl font-bold mb-6 text-[#b9da05]"><i class="fas fa-edit mr-2"></i>Edit Announcement</h2>

        <form id="editAnnouncementForm" class="space-y-6">
        <input type="hidden" id="editId" />

        <div>
            <label class="block text-white font-semibold mb-2">Title</label>
            <input id="editTitle" type="text"
            class="w-full px-4 py-3 bg-[#00071c] border border-white/20 rounded-lg text-white placeholder-gray-400 focus:border-[#b9da05] focus:outline-none" />
        </div>

        <div>
            <label class="block text-white font-semibold mb-2">Announcement Text</label>
            <textarea id="editSummary" rows="3"
            class="w-full px-4 py-3 bg-[#00071c] border border-white/20 rounded-lg text-white placeholder-gray-400 focus:border-[#b9da05] focus:outline-none resize-none"></textarea>
        </div>

        <div>
            <label class="block text-white font-semibold mb-2">Full Content</label>
            <textarea id="editContent" rows="6"
            class="w-full px-4 py-3 bg-[#00071c] border border-white/20 rounded-lg text-white placeholder-gray-400 focus:border-[#b9da05] focus:outline-none resize-none"></textarea>
        </div>

        <div>
            <label class="block text-white font-semibold mb-2">Posted By</label>
            <input id="editPostedBy" type="text"
            class="w-full px-4 py-3 bg-[#00071c] border border-white/20 rounded-lg text-white focus:border-[#b9da05] focus:outline-none" />
        </div>

        <div class="pt-4 flex justify-end space-x-3">
            <button type="button" onclick="closeEditModal()" class="px-6 py-3 rounded-lg font-semibold bg-gray-600 hover:bg-gray-700">Cancel</button>
            <button type="submit" onclick="updateAnnouncementFromModal()" class="bg-[#b9da05] text-[#011538] px-6 py-3 rounded-lg font-semibold hover:bg-[#9abc04] transition-colors">
            Save Changes
            </button>
        </div>
        </form>
    </div>
    </div>


    <script>
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('sidebarToggle');

        toggleBtn.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });

        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.getAttribute('data-tab');
                    
                    // Remove active class from all buttons and panels
                    tabButtons.forEach(btn => {
                        btn.classList.remove('border-[#b9da05]', 'bg-[#011538]', 'text-white');
                        btn.classList.add('text-gray-400');
                    });
                    tabPanels.forEach(panel => panel.classList.add('hidden'));
                    
                    // Add active class to clicked button and corresponding panel
                    button.classList.add('border-[#b9da05]', 'bg-[#011538]', 'text-white');
                    button.classList.remove('text-gray-400');
                    document.getElementById(targetTab).classList.remove('hidden');
                });
            });
        });
    </script>
    <script>
    const API_BASE = "/updated-msc-website/api";

    // Generic API function
    async function apiCall(endpoint, method = "GET", data = null, title = "") {
    try {
        const options = {
        method: method,
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        };
        if (data) options.body = JSON.stringify(data);

        console.log(`ðŸš€ ${method} ${endpoint}:`, data);
        const response = await fetch(`${API_BASE}${endpoint}`, options);
        const result = await response.json();

        if (!response.ok) throw new Error(result.message || "API error");
        return result;
    } catch (error) {
        console.error("API Error:", error);
        alert("Error: " + error.message);
        return null;
    }
    }

    // Fetch all announcements
    async function loadAnnouncements() {
    const data = await apiCall(`/announcements?page=1&limit=10&include_archived=false`, "GET");
    
    // drill into response structure
    const announcements = data?.data?.announcements || [];
    window.lastAnnouncements = announcements; // <--- keep announcements globally


    const container = document.getElementById("activeAnnouncements");
    container.innerHTML = "";

    if (announcements.length === 0) {
        container.innerHTML = `<p class="text-gray-400">No announcements found.</p>`;
        return;
    }

    announcements.forEach((a) => {
        const card = document.createElement("div");
        card.className = "bg-[#00071c] border border-white/20 rounded-lg p-6 text-white";
        card.innerHTML = `
        <h4 class="text-xl font-semibold text-[#b9da05] mb-3">${a.title}</h4>
        <p class="text-gray-300 mb-3">${a.content}</p>
        <p class="text-gray-200">Posted by ${a.posted_by} on ${a.date_posted}</p>
        <div class="mt-4 flex space-x-2">
            <button onclick="editAnnouncement(${a.id})" class="bg-[#b9da05] text-[#011538] px-4 py-2 rounded-lg font-semibold hover:bg-[#9abc04] transition-colors">Edit Announcement</button>
            <button onclick="archiveAnnouncement(${a.id})" class="bg-gray-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-700 transition-colors">Archive</button>
        </div>
        `;
        container.appendChild(card);
    });
    }

    function renderAnnouncements(announcements) {
    const activeContainer = document.getElementById("activeAnnouncements");
    const archivedContainer = document.getElementById("archived");

    activeContainer.innerHTML = "";
    archivedContainer.innerHTML = "";

    announcements.forEach((a) => {
        const card = `
        <div class="bg-white shadow-lg rounded-lg p-6 mb-4">
            <h3 class="text-xl font-bold text-gray-800 mb-2">${a.title}</h3>
            <p class="text-gray-600 mb-4">${a.content}</p>
            <p class="text-sm text-gray-500">Posted by: ${a.posted_by} | ${a.date_posted}</p>
            <div class="mt-4 flex gap-2">
            ${
                a.is_archived == 1
                ? ""
                : `<button onclick="openEditModal(${a.id}, '${a.title}', '${a.content}', '${a.posted_by}')"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                        Edit
                    </button>
                    <button onclick="archiveAnnouncement(${a.id})"
                        class="bg-gray-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-700 transition-colors">
                        Archive
                    </button>`
            }
            </div>
        </div>
        `;

        if (a.is_archived == 1) {
        archivedContainer.innerHTML += card;
        } else {
        activeContainer.innerHTML += card;
        }
    });
    }

    async function updateAnnouncementFromModal() {
    const id = document.getElementById("editId").value;
    const data = {
        title: document.getElementById("editAnnouncementTitle").value,
        content: document.getElementById("editAnnouncementContent").value,
        posted_by: document.getElementById("editAnnouncementPostedBy").value,
    };

    const result = await apiCall(
        `/announcements/${id}`,
        "PUT",
        data,
        `âœï¸ Update Announcement #${id}`
    );

    if (result && result.success) {
        closeModal("editAnnouncementModal"); // close modal after update
        loadAnnouncements(); // refresh announcements list
    }
    }

    async function archiveAnnouncement(id) {
    const confirmed = confirm("Are you sure you want to archive this announcement?");
    if (!confirmed) return;

    await apiCall(`/announcements/${id}/archive`, "POST", null, `ðŸ“¦ Archive Announcement #${id}`);


    // Refresh the lists after archiving
    loadAnnouncements();
    }


    // Save new announcement
    document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("addAnnouncementForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const title = document.getElementById("newTitle").value;
        const summary = document.getElementById("newSummary").value;
        const content = document.getElementById("newContent").value;
        const postedBy = document.getElementById("newPostedBy").value;

        const res = await apiCall(`/announcements`, "POST", {
        title, summary, content, posted_by: postedBy
        });

        if (res) {
        loadAnnouncements(); // Refresh active tab
        }
    });

    loadAnnouncements(); // Load announcements on page load
    });

    // Open modal with data
    function editAnnouncement(id) {
    // Find announcement from last loaded data
    const ann = window.lastAnnouncements?.find(a => a.id === id);
    if (!ann) return;

    document.getElementById("editId").value = ann.id;
    document.getElementById("editTitle").value = ann.title || "";
    document.getElementById("editSummary").value = ann.summary || "";
    document.getElementById("editContent").value = ann.content || "";
    document.getElementById("editPostedBy").value = ann.posted_by || "";

    document.getElementById("editModal").classList.remove("hidden");
    }

    // Close modal
    function closeEditModal() {
    document.getElementById("editModal").classList.add("hidden");
    }

    // Handle save
    document.getElementById("editAnnouncementForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const id = document.getElementById("editId").value;
    const title = document.getElementById("editTitle").value;
    const summary = document.getElementById("editSummary").value;
    const content = document.getElementById("editContent").value;
    const posted_by = document.getElementById("editPostedBy").value;

    const res = await apiCall(`/announcements/${id}`, "PUT", {
        title, summary, content, posted_by
    });

    if (res) {
        closeEditModal();
        loadAnnouncements();
    }
    });
    </script>

</body>
</html>
